<!doctype html>
<html>

<head>

	<title>Weather Forecast</title>
	<meta charset="utf-8" />
    
    <!-- Bootstrap -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    
     <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.13.0/jquery.validate.min.js"></script>
    <script src="http://openlayers.org/api/OpenLayers.js"></script>
    
     
    
<!--
  <script src="jquery-1.11.3.min.js" type="text/javascript"></script>
    <script src="jquery.validate.js" type="text/javascript"></script> 
-->
    <script type="text/javascript">
        $("document").ready(function() {
            
               $("#inputForm").validate({
                  
                   rules:
                   {  
                     address:
                       {
                           required:true
                       },
                       
                       city:{
                        required:true
                       },
                       
                       state:{
                        required:true       
                       }
                       
                   },
                       
                   messages:
                   {
                   address:"Please enter the street address",
                   city:"Please enter the city",
                   state:"Please select a state"       
                   },
                  
                  
                 submitHandler:function(form)
                   {
                       var data={
                           'city1':$('input[name=city]').val(),
                           'address1':$('input[name=address]').val(),
                           'state1':$('#state :selected').text(),
                           'unit1':$('input[name=unit]:checked','#inputForm').val()
                       };
                    console.log(data);
                   $.ajax({
                       
                       type: 'GET',
                       data:data,
                       datatype: 'json',
                       url: "returnWeatherData.php",
                       success: function (weather_data){
                           var response=JSON.parse(weather_data);
                           console.log(response); 
                         
                                if($('input[name=unit]:checked', '#inputForm').val()== "us")
                                {
                                   var unit="F";
                                }
                                    else
                                    {
                                   var unit="C";
                                    }
                                var timezone=response["timezone"];
                                var icon=response["currently"]["icon"];
                                var summary=response["currently"]["summary"];
                                var temperature=response["currently"]["temperature"];
                                var dewpoint=response["currently"]["dewPoint"];
                                var humidity=response["currently"]["humidity"];
                                var windspeed=response["currently"]["windSpeed"];
                                var visibility=response["currently"]["visibility"];
                                var precipProbability=response["currently"]["precipProbability"];
                                var precipIntensity =response["currently"]["precipIntensity"];
                                var sunsetTime=response["daily"]["data"][0]["sunsetTime"];
                                var sunriseTime=response["daily"]["data"][0]["sunriseTime"];
                                if(0 <= precipIntensity && precipIntensity < 0.002)
                                     {
                                       var precipitation="None";
                                     }
                                  else  if(0.002 <= precipIntensity && precipIntensity < 0.017)
                                     {
                                       var precipitation="Very Light";
                                     }

                                 else  if(0.017 <= precipIntensity && precipIntensity < 0.1)
                                 {
                                      var precipitation="Light";
                                 }
                                 else  if(0.1 <= precipIntensity && precipIntensity < 0.4)
                                 {
                                      var precipitation="Moderate";
                                  }
                                else  if(0.4 <= precipIntensity)
                                {
                                      var precipitation="Heavy";
                                }
                                     var chancesOfRain=(precipIntensity*100)+"%";
                                     
                           if(unit == "C")
                                      {
                                          windspeed+=" m/s";
                                          visibility+=" Km";
                                        //var  pressure+="hPa"
                                      }
                                      else
                                      {
                                         
                                         windspeed+=" mph";
                                          visibility+=" mi";
                                         //var pressure+="mb";
                                      }  
 
                                   
    //use setcenter to set the zoom and location                       
     //adjust opacity of layers                      
    $('#result').css("display","block");
   $('#weatherData').empty();
     $('#weatherIcon').empty();  
    $('#currentDataTable').empty();  
        $('#dayDataTable').empty();                   
    switch(icon){
            
            case "clear-day": 
                $('#weatherIcon').append('<img src="http://cs-server.usc.edu:45678/hw/hw8/images/clear.png"  alt=icon  title=summary style="width:80px;height:80px;" align="center" ></img>');
                break;
            case "clear-night": 
                 $('#weatherIcon').append('<img src="http://cs-server.usc.edu:45678/hw/hw8/images/clear_night.png"  alt=icon  title=summary style="width:80px;height:80px;" align="center" ></img>');
                break;
            case "rain": 
                 $('#weatherIcon').append('<img src="http://cs-server.usc.edu:45678/hw/hw8/images/rain.png"  alt=icon  title=summary style="width:80px;height:80px;" align="center"></img>');
                break;
            case "snow": 
                  $('#weatherIcon').append('<img src="http://cs-server.usc.edu:45678/hw/hw8/images/snow.png"  alt=icon  title=summary style="width:80px;height:80px;"  align="center"></img>');
                break;
            case "sleet": 
                  $('#weatherIcon').append('<img src="http://cs-server.usc.edu:45678/hw/hw8/images/sleet.png"  alt=icon  title=summary style="width:80px;height:80px;"  align="center"></img>');
                break;
            case "wind": 
                  $('#weatherIcon').append('<img src="http://cs-server.usc.edu:45678/hw/hw8/images/wind.png"  alt=icon  title=summary style="width:80px;height:80px;" align="center" ></img>');
                break;
            case "fog": 
                 $('#weatherIcon').append('<img src="http://cs-server.usc.edu:45678/hw/hw8/images/fog.png"  alt=icon  title=summary style="width:80px;height:80px;" align="center"></img>');
                break;
            case "cloudy": 
                 $('#weatherIcon').append('<img src="http://cs-server.usc.edu:45678/hw/hw8/images/cloudy.png"  alt=icon  title=summary style="width:80px;height:80px;"  align="center"></img>');
                break;
            case "partly-cloudy-day": 
                 $('#weatherIcon').append('<img src="http://cs-server.usc.edu:45678/hw/hw8/images/cloud_day.png"  alt=icon  title=summary style="width:80px;height:80px;" align="center" ></img>');
                break;
            case "partly-cloudy-night": 
                  $('#weatherIcon').append('<img src="http://cs-server.usc.edu:45678/hw/hw8/images/cloud_night.png"  alt=icon  title=summary style="width:80px;height:80px;" align="center"></img>');
                break;
                
                
        }
    
      $('#weatherData').append('<p  style="color:white;font-size:95%;" align="center">'+summary+'&nbsp;in&nbsp;'+$('input[name=city]').val()+','+$('#state :selected').text()+'<h1 style="color:white;" align="center">'+ Math.round(temperature)+'<sup style="color:white;">o'+unit+'</sup>&nbsp;</h1><br><p style="color:#3D1FDD" align="center">L:&nbsp;'+ response["daily"]["data"][0]["temperatureMin"] +'<sup>o</sup><span  style="color:#4D7E28;">|H:&nbsp;'+ response["daily"]["data"][0]["temperatureMax"] +'<sup>o</sup></span></p><img src="http://cs-server.usc.edu:45678/hw/hw8/images/fb_icon.png" class="pull-right" title="Facebook Post" length="40" width="40">');                         
                             
                                               
     $('#currentDataTable').append('<tr><td>Precipitation</td><td>'+precipitation+'</td></tr><tr><td>Chances of Rain</td><td>'+ chancesOfRain +'</td></tr><tr><td>Wind Speed</td><td>'+windspeed+'</td></tr><tr><td>Dew Point</td><td>'+dewpoint +'<sup>o</sup>'+unit+'</td></tr><tr><td>Humidity</td><td>'+humidity  +'%</td></tr><tr><td>Visibility</td><td>'+ visibility+'</td></tr><tr><td>Sunrise</td><td>'+timeFormatter(sunriseTime) +'</td></tr><tr><td>Sunset</td><td>'+timeFormatter(sunsetTime)+'</td></tr>');
                           
    $('#dayDataTable').append('<tr ><th style="background-color:#2F70A8;color:white;">Time</th><th style="background-color:#2F70A8;color:white;">Summary</th><th style="background-color:#2F70A8;color:white;">Cloud Cover</th><th style="background-color:#2F70A8;color:white;">Temp (&degF)</th><th style="background-color:#2F70A8;color:white;">View Details</th></tr>');
    
  for(var i=0;i<25;i++)
  {
switch(icon){
            
            case "clear-day": 
                var imageIcon='<img src="http://cs-server.usc.edu:45678/hw/hw8/images/clear.png"  alt=icon  title=summary style="width:40px;height:40px;" align="center" ></img>';
                break;
            case "clear-night": 
                var imageIcon='<img src="http://cs-server.usc.edu:45678/hw/hw8/images/clear_night.png"  alt=icon  title=summary style="width: 40px;height:40px;" align="center" ></img>';
                break;
            case "rain": 
                 var imageIcon='<img src="http://cs-server.usc.edu:45678/hw/hw8/images/rain.png"  alt=icon  title=summary style="width:40px;height:40px;" align="center" ></img>';
                break;
            case "snow": 
                   var imageIcon='<img src="http://cs-server.usc.edu:45678/hw/hw8/images/snow.png"  alt=icon  title=summary style="width:40px;height:40px;" align="center" ></img>';
                break;
            case "sleet": 
                  var imageIcon='<img src="http://cs-server.usc.edu:45678/hw/hw8/images/sleet.png"  alt=icon  title=summary style="width:40px;height:40px;" align="center" ></img>';
                break;
            case "wind": 
                   var imageIcon='<img src="http://cs-server.usc.edu:45678/hw/hw8/images/wind.png"  alt=icon  title=summary style="width:40px;height:40px;" align="center" ></img>';
                break;
            case "fog": 
                 var imageIcon='<img src="http://cs-server.usc.edu:45678/hw/hw8/images/fog.png"  alt=icon  title=summary style="width:40px;height:40px;" align="center" ></img>';
                break;
            case "cloudy": 
                 var imageIcon='<img src="http://cs-server.usc.edu:45678/hw/hw8/images/cloudy.png"  alt=icon  title=summary style="width:40px;height:40px;" align="center" ></img>';
                break;
            case "partly-cloudy-day": 
                 var imageIcon='<img src="http://cs-server.usc.edu:45678/hw/hw8/images/cloud_day.png"  alt=icon  title=summary style="width:40px;height:40px;" align="center" ></img>';
                break;
            case "partly-cloudy-night": 
                  var imageIcon='<img src="http://cs-server.usc.edu:45678/hw/hw8/images/cloud_night.png"  alt=icon  title=summary style="width:40px;height:40px;" align="center" ></img>';
                break;     
        }                           
          
       
       $('#dayDataTable').append('<tr><td>' + timeFormatter(response.hourly.data[i].time) + '</td><td>' + imageIcon + '</td><td>' + (response.hourly.data[i].cloudCover * 100).toFixed(0) + '%</td><td>' + response.hourly.data[i].temperature + '</td><td><span class="glyphicon glyphicon-plus" data-toggle="collapse" data-target="#viewDetail'+ i +'" aria-expanded="false" aria-controls="viewDetail'+ i +'" aria-hidden="true"></span></td></tr>');
      
 $('#dayDataTable').append('<tr class="collapse" id="viewDetail'+ i +'"><td colspan="5"><div class="table-responsive"><table class="table table-striped"><tr><th>Wind</th><th>Humidity</th><th>Visibility</th><th>Pressure</th></tr><tr><td>' + (response.hourly.data[i].windSpeed).toFixed(2) + 'mph</td><td>' + Math.round(response.hourly.data[i].humidity * 100) + '%</td><td>' + (response.hourly.data[i].visibility).toFixed(2) + 'mi</td><td>' + response.hourly.data[i].pressure + 'mb</td></tr>');
                                  
  }
                               
                           
                       }
                       
                         });
                     return false;
                   }
                  
            });
            
            
          
        });
         function timeFormatter(dateTime){
                        //multiply by 1000 to convert the unix timestamp to milliseconds
                        var date = new Date(dateTime * 1000);
                        if (date.getHours()>=12){
                                var hour = parseInt(date.getHours()) - 12;
                                hour = (hour == '0' ? 12 : hour);
                                var amPm = "PM";
                        } else {
                                var hour = date.getHours();
                                hour = (hour == '0' ? 12 : hour);
                                var amPm = "AM";
                        }
                        var time = (hour < 10 ? '0'+hour : hour)   + ":" + (date.getMinutes() < 10 ? '0'+ date.getMinutes() : date.getMinutes()) + " " + amPm;
                        console.log(time);
                        return time;
                }
        
         var states=["Select your state...", "Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "District Of Columbia", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"];

        var value=["", "AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"];
        
        function initializeSelect(){
            var select = document.getElementById("state");
            for(var i = 0; i < states.length; i++) {
                 var opt = document.createElement("option");
                   opt.innerHTML = states[i];
                     opt.value = value[i];
                       select.appendChild(opt);
                                   }
            select.selectedIndex=0;
        }
        
        function clearForm()
             {
                 document.getElementById("address").value="";
                 document.getElementById("city").value="";
                var select= document.getElementById("state");
                 select.selectedIndex=0;
                 document.getElementById("Fahrenheit").checked=true; 
                  document.getElementById("Celsius").checked=false; 
                     document.getElementById("result").style.display="none";
             }
        



       
    </script>
    
    <style>
        
        body{
            
            background: url("http://cs-server.usc.edu:45678/hw/hw8/images/bg.jpg") no-repeat center center fixed; 
            background-size:cover;
            -moz-background-size: cover;
        }
        
        .main{
            background: rgba(30,30,30,0.4);
            color: white;
            padding: 10px;
        }
        
        
        
        h2#title{
            padding-top: 0;
            margin-top: 0;
            color: black;
        }
        
        .required{
            color: red;
            
        }
        
        .requiredField{
            color: red;
            margin:3px;
            padding: 0;
            display: none;
            font-size:85%;   
        }
        
        #footer {
 	 	 width:100%;
                }
        
        #myTab li a{
         background-color:#EDEDED; 
         color: #2F70A8;
            
        }
        
        #myTab li.active a{
         background-color: #2F70A8;  
         color: #EDEDED;
            
        }
        
        .topHeader {
         background-color:#F27E7F; 
            padding:20px;
          margin:0px auto;
            
           
        }
        
          
        .headerRow{
            
            background-color:#2F70A8; 
            color:white;
            font-weight:bold;   
        }
        
      
        .table-striped>tbody>tr:nth-child(odd)>td,
.table-striped>tbody>tr:nth-child(odd)>th {
	       background-color: #F9F9F9;
    
}
        .table{
         background: #F1DDDD;
         margin:0;
         padding:0;
            
        }
        
       
        
       
    </style>
    
    
    
    

	  
</head>

<body>
  <div class="container">
    <div class="container label">
        
        <h2 id="title"> Forecast Search</h2>
    
    </div>
            
    <div class="main">
        
        <div class="row">
        <form id="inputForm" role="form" method="GET" >
            <div class="col-md-2">
                Street:<span class="required">*</span>
                <div class="form-group">
                    <input type="text" class="form-control input-sm" placeholder="Enter street address" id="address" minlength="1" name="address" required >
                </div>

            </div>
            
            <div class="col-md-2">
                City:<span class="required">*</span>
                <div class="form-group">
                    <input type="text" class="form-control input-sm" placeholder="Enter the city" id="city" name="city" minlength="1" required>
                </div>

            </div>
            
            <div class="col-md-2">
                State:<span class="required">*</span>
                <div class="form-group">
                    <select class="form-control input-sm" id="state" name="state" required>
                    </select>
                </div>

            </div>
            
            <script type="text/javascript">
                initializeSelect();
            </script>
            
            <div class="col-md-3">
                Degree:<span class="required">*</span>
                <div class="radio">
                   <label class="radio-inline input"><input type="radio" name="unit" value="us" id="Fahrenheit" checked>Fahrenheit</label>
                    <label class="radio-inline input"><input type="radio" name="unit" value="si" id="Celsius" >Degree</label>
    
            </div>
        </div>
            
         
            <div class="col-md-3"><span class="pull-right">
                
                    <button type="submit" class="btn btn-primary btn-sm" aria-label="Left Align" id="search">
                        <span class="glyphicon glyphicon-search"></span>
                        Search
                    </button>
                      &nbsp;
                    <button type="button" class="btn btn-default btn-sm" aria-label="Left Align" id="clear" onclick="clearForm()">
                        <span class="glyphicon glyphicon-refresh"></span>
                        Clear
                    </button>
             
            
            </div>
        </form>         
        </div>
            <br/>
        <div class="row">
         <div class="col-md-2"></div>   
        <div class="col-md-2"></div> 
         <div class="col-md-2"></div>    
           <div class="col-md-3"></div> 
            <div class="col-md-3"><span class="pull-right">
            <p style="color:white;float:left;">Powered by:</p>                
 	 	 	<a href="http://forecast.io/"><img src="http://cs-server.usc.edu:45678/hw/hw8/images/forecast_logo.png" style="width:90px;height:50px;float:left;margin-left:5px;position:relative;bottom:12px;"></img></a>
            </div> 
        </div> 
    </div>
 
      <hr>
    
    <div class="" id="result" style="display:none;">

      <ul class="nav nav-tabs " id="myTab">
        <li class="active"><a data-toggle="tab" href="#home">Right Now</a></li>
        <li><a data-toggle="tab" href="#menu1">Next 24 Hours</a></li>
        <li><a data-toggle="tab" href="#menu2">Next 7 Days</a></li>
      </ul>

      <div class="tab-content">
          
           <div id="home" class="tab-pane fade in active">
                    HI
                   <div class="row">
                       
                        <div class="col-md-6" style="padding:0px;">
                            <div class="row">
                                HI
                                <div class="col-md-6 topHeader" id="weatherIcon">
                                </div>
                                       
                                <div class="col-md-6 topHeader" id="weatherData">
                                </div>
                            </div>
                            <div class="table-responsive">
                               <table class="table table-striped table-bordered" id="currentDataTable">
                  
                                </table> 
                                
                          </div>
                           </div>
                   
                          <div class="col-md-6" style="padding:0px;height:100%;">
                               <img src="http://curiositysip.com/wp-content/uploads/2015/08/Sunflower-13.jpg" style="width:100%;height:100%;"></img>   
                   
                          </div>   
                   
               
                     </div>
               
           </div>
       
          <div id="menu1" class="tab-pane fade">
             <table class="table table-striped " id="dayDataTable">
                  
            </table> 
          </div>
        
          <div id="menu2" class="tab-pane fade">
             <h3>Menu 2</h3>
             <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
        </div>
        
          <div id="menu3" class="tab-pane fade">
            <h3>Menu 3</h3>
            <p>Eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
        
          </div>
          
    </div>
            
    </div>
        
  </div>
    
</body>

</html>
